<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html" />
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">

<link rel="import" href="../shared/shared-graph.html">

<dom-module id="leboucher-drills">
    <template>
        <style>
            table,
            td,
            th {
                vertical-align: middle;
            }
            
            table {
                border-collapse: separate;
                border-spacing: 0;
                border-top: 1px solid white;
                margin-bottom: 28px;
                width: 100%;
                text-align: left;
                font-size: 12px;
                font: "Robotro";
            }
            
            th {
                border-top: 5px solid #555555;
                color: #ffffff;
                padding: 10px;
                text-transform: uppercase;
                background-color: #1f1f1f;
            }
            
            td {
                padding: 10px;
            }
            
            td,
            th {
                border-bottom: 1px solid #1f1f1f;
            }
            
            .container {
                @apply(--layout-vertical);
                @apply(--layout-center-justified);
            }
            
            paper-card {
                --paper-card-header-background: green;
                margin-bottom: 10px;
            }
        </style>

        <div id="content" class="container">

            <template is="dom-repeat" items="{{tables}}" as="table">

                <paper-card heading="[[table.length]] step drills" image="" elevation="1" animated-shadow="false">
                    <div class="card-content">

                        <table>
                            <thead>
                                <tr>
                                    <template is="dom-repeat" items="{{table.header}}" as="item">
                                        <td>[[item]]</td>
                                    </template>
                                </tr>
                            </thead>
                            <tbody>
                                <template is="dom-repeat" items="{{table.data}}" as="item">
                                    <tr>
                                        <template is="dom-repeat" items="{{item}}" as="cell">
                                            <td>[[_nodeLabel(data, cell)]]</td>
                                        </template>
                                    </tr>
                                </template>
                            </tbody>
                        </table>

                    </div>
                </paper-card>

            </template>

        </div>

    </template>

    <script>
        Polymer({
            is: 'leboucher-drills',
            properties: {
                data: {
                    type: Object,
                    value: undefined,
                    observer: "_dataChanged"
                },

                tables: Array
            },

            attached: function() {

            },

            _nodeLabel: function(data, id) {
                return this.data.nodes.find(function(node) {
                    return node.id === id;
                }).label;
            },

            _dataChanged: function(newValue) {

                if (newValue === undefined) {
                    return;
                }

                var result = GraphLibrary.orderedCycles(this.data.nodes, this.data.edges);

                result.forEach(function(r) {
                    r.header = this._generateHeader(r.length);
                }.bind(this));

                this.tables = result;

                //var minimalCycles = GraphLibrary.minialCoveringCycles(result, this.data.edges);
                //console.log(minimalCycles);
            },

            _generateHeader: function(length) {

                var data = ["A", "B", "B", "A"];

                var result = [];

                for (var i = 0; i < length; i++) {
                    result.push(data[i % data.length]);
                }

                return result;
            }
        });
    </script>

</dom-module>